# JSON Schema Validation

A simple JSON Schema Validation

[![Build Status](https://travis-ci.org/demsking/jsonschemav.svg?branch=master)](https://travis-ci.org/demsking/jsonschemav) [![Known Vulnerabilities](https://snyk.io/test/github/demsking/jsonschemav/badge.svg)](https://snyk.io/test/github/demsking/jsonschemav) [![Coverage Status](https://coveralls.io/repos/github/demsking/jsonschemav/badge.svg?branch=master)](https://coveralls.io/github/demsking/jsonschemav?branch=master)

## Install

```sh
npm install --save jsonschemav
```

## Usage

```javascript
const JsonSchemav = require('jsonschemav')
const jsv = new JsonSchemav()

const schema = { type: 'string', minLength: 6 }
const instance = jsv.compile(schema)

console.log(instance.validate('Hello, World!'))
// true

console.log(instance.validate('Hello'))
// [ { keyword: 'minLength',
//    size: 5,
//    minLength: 6,
//    message: 'not enough characters. must be greater than, or equal to, 6' } ]

console.log(instance.validate(true)) 
// [ { keyword: 'type', message: 'invalid type input' } ]
```

### Async Validation

```javascript
const axios = require('axios')
const JsonSchemav = require('jsonschemav')
const ValidationError = require('jsonschemav/lib/generic').ValidationError

const options = { async: true }
const jsv = new JsonSchemav(options)
const endpoint = 'https://twitter.com/users/username_available'

jsv.addType('twitter', (data) => new Promise((resolve, reject) => {
  axios.get(`${endpoint}?username=${data.value}`)
    .then((response) => {
      if (response.data.valid) {
        const message = `The username '${data.value}' does not exists`
        const report = { keyword: 'notfound' }

        return reject(new ValidationError(message, report))
      }

      resolve(data.value)
    }).catch(reject)
}))

jsv.compile(schema).then(async (instance) => {
  try {
    await instance.validate('nonexistingac')
  } catch (err) {
    console.error(err.message)
    // The username 'nonexistingac' does not exists
    console.error(err.errors)
    // [ { keyword: 'notfound' } ]
  }

  try {
    await instance.validate('demsking')
    console.log('success')
  } catch (err) {
    console.error(err)
  }
})
```

## Instance API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### validateSchema

Validate a schema. Throws an error for invalid schema

**Parameters**

-   `schema` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Schema to validate

**Examples**

```javascript
const jsv = new JsonSchemav()
const schema = { type: 'string' }

try {
  jsv.validateSchema(schema)
} catch (err) {
  console.error(err)
}
```

### compile

Compile a schema

**Parameters**

-   `schema` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Schema to compile

**Examples**

```javascript
const jsv = new JsonSchemav()
const schema = { type: 'string' }
const data = 'Hello, World!'

jsv.compile(schema).then((instance) => {
  instance.validate(data)
    .then((parsedData) => {
      // use `parsedData` instead `data`
    })
    .catch((err) => {
      // err.errors is a list of parsing error
    })
})
```

Returns **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Returns an interface with the `validate` member

### addCompileStep

Add a compile step function to a type

**Parameters**

-   `type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the type
-   `compileStepFn` **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** A compile function

### addAlias

Add an alias for a type

**Parameters**

-   `type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of a defined type
-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The alias name

**Examples**

```javascript
const jsv = new JsonSchemav()

jsv.addAlias('integer', 'int')

const schema = { type: 'int' }
const instance = jsv.compile(schema)

const result = instance.validate(123) // true
```

### addType

Add a new type to the instance

**Parameters**

-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the new type
-   `validateFn` **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)?** A validate function for the new type

**Examples**

```javascript
const jsv = new JsonSchemav()

jsv.addType('binary', (data) => {
  return Number.isInteger(data) && /^[01]+$/.test(data.toString())
})

const schema = { type: 'binary' }
const instance = jsv.compile(schema)

const result = instance.validate(1111011) // true
```

### removeType

Remove a type from the instance

**Parameters**

-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The nema of the type

**Examples**

```javascript
const jsv = new JsonSchemav()

jsv.removeType('string')

const schema = { type: 'string' }
const instance = jsv.compile(schema)
// throw Error: Unknown type 'string'
```

### addKeyword

Add a new keyword to a type

**Parameters**

-   `type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the type
-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the new keyword
-   `validateFn` **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** A validate function for the new keyword

### removeKeyword

Remove a keyword from a type

**Parameters**

-   `type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the type
-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the keyword

**Examples**

```javascript
const jsv = new JsonSchemav()

jsv.removeKeyword('string', 'minLength')

const schema = { type: 'string', minLength: 5 }
const instance = jsv.compile(schema)
const data = 'abc'
const result = instance.validate(data) // true
```

## License

Under the MIT license. See [LICENSE](https://github.com/demsking/jsonschemav/blob/master/LICENSE) file for more details.
